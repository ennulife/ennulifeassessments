(()=>{document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".ennu-user-dashboard");e&&new t(e)});class t{constructor(t){this.dashboard=t,this.init()}init(){this.initDetailsToggle(),this.initPillarHovers(),this.initScoreAnimation(),this.initPillarAnimation(),this.initHistoricalCharts(),this.initHealthMapAccordion(),this.initToggleAll()}initToggleAll(){const t=this.dashboard.querySelector("#toggle-all-accordions");if(!t)return;const e=this.dashboard.querySelectorAll(".accordion-item");t.addEventListener("click",()=>{const t=this.dashboard.querySelectorAll(".accordion-item.open").length===e.length;e.forEach(e=>{const i=e.querySelector(".accordion-content");t?(e.classList.remove("open"),i.style.maxHeight=null):(e.classList.add("open"),i.style.maxHeight=i.scrollHeight+"px")})})}initHealthMapAccordion(){const t=this.dashboard.querySelector(".health-map-accordion");t&&t.addEventListener("click",t=>{const e=t.target.closest(".accordion-header");if(!e)return;const i=e.closest(".accordion-item"),a=i.querySelector(".accordion-content");i.classList.toggle("open"),i.classList.contains("open")?a.style.maxHeight=a.scrollHeight+"px":a.style.maxHeight=null})}initDetailsToggle(){this.dashboard.addEventListener("click",t=>{const e=t.target.closest(".assessment-list-item .details-toggle-icon");if(!e)return;t.preventDefault(),t.stopPropagation();const i=e.closest(".assessment-list-item"),a=i.querySelector(".category-details-container"),o="true"===i.getAttribute("aria-expanded");i.setAttribute("aria-expanded",!o),o?(a.style.maxHeight=null,e.classList.remove("active")):(a.style.maxHeight=a.scrollHeight+"px",e.classList.add("active"))})}initPillarHovers(){const t=this.dashboard.querySelector(".pillar-context-display");t&&(this.dashboard.addEventListener("mouseenter",e=>{const i=e.target.closest(".pillar-orb");if(!i)return;const a=i.dataset.insight;a&&(t.textContent=a,t.style.opacity="1",t.style.display="block")},!0),this.dashboard.addEventListener("mouseleave",e=>{e.target.closest(".pillar-orb")&&(t.style.opacity="0",setTimeout(()=>{"0"===t.style.opacity&&(t.style.display="none")},200))},!0))}initScoreAnimation(){const t=this.dashboard.querySelector(".main-score-orb");if(!t)return;const e=this.dashboard.querySelector(".main-score-insight"),i=parseFloat(t.dataset.score)||0,a=t.querySelector(".main-score-value");a.textContent="0.0",setTimeout(()=>{t.classList.add("loaded"),e&&e.classList.add("visible");let o=0;const s=t=>{o||(o=t);const e=t-o,r=Math.min(e/1500*i,i);a.textContent=r.toFixed(1),e<1500?window.requestAnimationFrame(s):a.textContent=i.toFixed(1)};window.requestAnimationFrame(s)},500)}initPillarAnimation(){const t=this.dashboard.querySelectorAll(".pillar-orb");t.length>0&&t.forEach((t,e)=>{setTimeout(()=>{t.classList.add("visible"),setTimeout(()=>{t.classList.add("loaded")},300)},700+150*e)})}initHistoricalCharts(){const t=document.getElementById("ennuLifeScoreTimelineChart");t&&"undefined"!=typeof dashboardData&&dashboardData.score_history&&new Chart(t,{type:"line",data:{datasets:[{label:"ENNU LIFE SCORE",data:dashboardData.score_history.map(t=>({x:new Date(t.date),y:t.score})),borderColor:"rgba(52, 211, 153, 1)",backgroundColor:"rgba(52, 211, 153, 0.1)",fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{type:"time",time:{unit:"day"},grid:{color:"rgba(255, 255, 255, 0.1)"},ticks:{color:"rgba(255, 255, 255, 0.7)"}},y:{beginAtZero:!0,max:10,grid:{color:"rgba(255, 255, 255, 0.1)"},ticks:{color:"rgba(255, 255, 255, 0.7)"}}},plugins:{legend:{display:!1}}}});const e=document.getElementById("bmiHistoryChart");e&&"undefined"!=typeof dashboardData&&dashboardData.bmi_history&&new Chart(e,{type:"line",data:{datasets:[{label:"BMI",data:dashboardData.bmi_history.map(t=>({x:new Date(t.date),y:t.bmi})),borderColor:"rgba(96, 165, 250, 1)",backgroundColor:"rgba(96, 165, 250, 0.1)",fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{type:"time",time:{unit:"day"},grid:{color:"rgba(255, 255, 255, 0.1)"},ticks:{color:"rgba(255, 255, 255, 0.7)"}},y:{grid:{color:"rgba(255, 255, 255, 0.1)"},ticks:{color:"rgba(255, 255, 255, 0.7)"}}},plugins:{legend:{display:!1}}}})}}})();