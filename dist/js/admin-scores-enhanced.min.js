!function(){"use strict";window.ENNUAdminEnhanced=window.ENNUAdminEnhanced||{};var t={config:{maxRetries:3,retryDelay:1e3,requestTimeout:3e4,maxRequestsPerMinute:10,debugMode:!1},state:{requestCount:0,lastRequestTime:0,isProcessing:!1,retryAttempts:{}},errors:{log:[],maxLogSize:100},init:function(){try{if(this.log("Initializing ENNU Enhanced Admin System"),!this.checkDependencies())return void this.handleError("Dependencies check failed","DEPENDENCY_ERROR");this.loadConfig(),this.bindEvents(),this.initializeComponents(),this.initializeTabSwitching(),this.setupErrorMonitoring(),this.setupPerformanceMonitoring(),this.log("ENNU Enhanced Admin System initialized successfully")}catch(t){this.handleError("Initialization failed: "+t.message,"INIT_ERROR",t)}},checkDependencies:function(){var t=[];return"undefined"==typeof ennuAdminEnhanced&&t.push("ennuAdminEnhanced localization object"),!(t.length>0&&(this.log("Missing dependencies: "+t.join(", "),"error"),1))},loadConfig:function(){"undefined"!=typeof ennuAdminEnhanced&&(this.config=Object.assign(this.config,ennuAdminEnhanced.security||{}),this.strings=ennuAdminEnhanced.strings||{},this.ajaxUrl=ennuAdminEnhanced.ajaxurl,this.nonce=ennuAdminEnhanced.nonce)},bindEvents:function(){var t=this;try{document.addEventListener("click",function(e){"ennu-recalculate-scores"===e.target.id?t.handleRecalculateScores(e):"ennu-export-data"===e.target.id?t.handleExportData(e):"ennu-sync-hubspot"===e.target.id?t.handleSyncHubSpot(e):"ennu-clear-cache"===e.target.id?t.handleClearCache(e):"ennu-clear-data"===e.target.id&&t.handleClearUserData(e)}),window.addEventListener("unhandledrejection",this.handleUnhandledRejection.bind(this)),window.addEventListener("error",this.handleGlobalError.bind(this)),this.log("Event handlers bound successfully")}catch(t){this.handleError("Failed to bind events: "+t.message,"BIND_ERROR",t)}},initializeComponents:function(){try{document.querySelectorAll(".ennu-enhanced-admin-container [title]").forEach(function(t){t.addEventListener("mouseenter",function(){var t=document.createElement("div");t.className="ennu-tooltip",t.textContent=this.getAttribute("title"),document.body.appendChild(t),this.setAttribute("data-original-title",this.getAttribute("title")),this.removeAttribute("title")}),t.addEventListener("mouseleave",function(){var t=document.querySelector(".ennu-tooltip");t&&t.remove(),this.getAttribute("data-original-title")&&(this.setAttribute("title",this.getAttribute("data-original-title")),this.removeAttribute("data-original-title"))})}),this.animateProgressBars(),this.updateCacheStatus(),this.log("Components initialized successfully")}catch(t){this.handleError("Failed to initialize components: "+t.message,"COMPONENT_ERROR",t)}},initializeTabSwitching:function(){try{this.log("Initializing tab switching");var t=document.querySelector(".ennu-admin-tab-nav");if(t){var e=t.querySelectorAll("a"),n=document.querySelectorAll(".ennu-admin-tab-content");e.forEach(function(t){t.addEventListener("click",function(t){t.preventDefault(),e.forEach(function(t){return t.classList.remove("ennu-admin-tab-active")}),n.forEach(function(t){return t.classList.remove("ennu-admin-tab-active")}),this.classList.add("ennu-admin-tab-active");var r=this.getAttribute("href").substring(1),i=document.getElementById(r);i&&i.classList.add("ennu-admin-tab-active")})})}var r=document.querySelectorAll(".nav-tab");r.length>0&&r.forEach(function(t){t.addEventListener("click",function(t){t.preventDefault(),r.forEach(function(t){return t.classList.remove("nav-tab-active")}),document.querySelectorAll(".tab-content").forEach(function(t){return t.classList.remove("active")}),this.classList.add("nav-tab-active");var e=this.getAttribute("data-tab");if(e){var n=document.getElementById(e);n&&n.classList.add("active")}})}),this.log("Tab switching initialized successfully")}catch(t){this.handleError("Tab switching initialization failed: "+t.message,"TAB_ERROR",t)}},setupErrorMonitoring:function(){var t=this,e=window.fetch;window.fetch=function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e.apply(this,r).catch(function(e){throw r[0]&&r[0].indexOf&&-1!==r[0].indexOf("ennu_")&&t.handleAjaxError(null,"error",e,{url:r[0]}),e})};var n=console.error;console.error=function(){t.logError("Console Error",Array.prototype.slice.call(arguments).join(" ")),n.apply(console,arguments)}},setupPerformanceMonitoring:function(){window.performance&&window.performance.mark&&window.performance.mark("ennu-admin-init-complete")},handleRecalculateScores:function(t){t.preventDefault();try{var e=t.currentTarget,n=this.getUserId();if(!n)return void this.showNotification(this.strings.error||"User ID not found","error");this.performAjaxOperation("recalculate_scores",{user_id:n},e,this.strings.recalculating||"Recalculating scores...")}catch(t){this.handleError("Recalculate scores failed: "+t.message,"RECALCULATE_ERROR",t)}},handleExportData:function(t){t.preventDefault();try{var e=t.currentTarget,n=this.getUserId();if(!n)return void this.showNotification(this.strings.error||"User ID not found","error");this.performAjaxOperation("export_user_data",{user_id:n},e,this.strings.exporting||"Exporting data...",this.handleExportSuccess.bind(this))}catch(t){this.handleError("Export data failed: "+t.message,"EXPORT_ERROR",t)}},handleSyncHubSpot:function(t){t.preventDefault();try{var e=t.currentTarget,n=this.getUserId();if(!n)return void this.showNotification(this.strings.error||"User ID not found","error");this.performAjaxOperation("sync_hubspot",{user_id:n},e,this.strings.syncing||"Syncing with HubSpot...")}catch(t){this.handleError("HubSpot sync failed: "+t.message,"HUBSPOT_ERROR",t)}},handleClearCache:function(t){t.preventDefault();try{var e=t.currentTarget,n=this.getUserId();this.performAjaxOperation("clear_cache",{user_id:n||0},e,this.strings.clearing_cache||"Clearing cache...")}catch(t){this.handleError("Clear cache failed: "+t.message,"CACHE_ERROR",t)}},handleClearUserData:function(t){if(t.preventDefault(),confirm(this.strings.confirm_clear||"Are you sure you want to permanently delete all ENNU assessment data for this user? This cannot be undone."))try{var e=t.currentTarget,n=e.dataset.userId;if(!n)return void this.showNotification(this.strings.error||"User ID not found","error");this.performAjaxOperation("clear_user_data",{user_id:n},e,"Clearing data...",function(){location.reload()})}catch(t){this.handleError("Clear user data failed: "+t.message,"CLEAR_DATA_ERROR",t)}},performAjaxOperation:function(t,e,n,r,i){var a=this;if(this.state.isProcessing)this.showNotification("Another operation is in progress. Please wait.","warning");else if(this.checkRateLimit()){this.state.isProcessing=!0;var s=Object.assign({action:"ennu_"+t,nonce:this.nonce},e);this.setButtonLoading(n,!0,r),this.showNotification(r,"loading"),this.ajaxWithRetry(s,t).then(function(t){a.handleAjaxSuccess(t,n,i)}).catch(function(t){a.handleAjaxError(t.xhr,t.status,t.error,{data:s}),a.setButtonLoading(n,!1)}).finally(function(){a.state.isProcessing=!1})}else this.showNotification(this.strings.rate_limit||"Too many requests. Please wait a moment.","error")},ajaxWithRetry:function(t,e,n){n=n||1;var r=this;return fetch(this.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(t)}).then(function(t){if(!t.ok)throw new Error("HTTP error! status: ".concat(t.status));return t.json()}).catch(function(i){if(n<r.config.maxRetries&&r.shouldRetry(i)){r.log("Retrying AJAX request for ".concat(e," (attempt ").concat(n+1,"/").concat(r.config.maxRetries,")"));var a=r.config.retryDelay*Math.pow(2,n-1);return new Promise(function(i,s){setTimeout(function(){r.ajaxWithRetry(t,e,n+1).done(i).fail(s)},a)})}return Promise.reject({xhr,status,error:i})})},shouldRetry:function(t,e){return"timeout"===e||"error"===e||0===t.status||t.status>=500&&t.status<600},handleAjaxSuccess:function(t,e,n){try{if(this.setButtonLoading($button,!1),t.success)this.showNotification(t.data.message||this.strings.success||"Operation completed successfully!","success"),n&&"function"==typeof n&&n(t.data),this.refreshPageData();else{var r=t.data&&t.data.message?t.data.message:this.strings.error||"An error occurred. Please try again.";this.showNotification(r,"error")}}catch(t){this.handleError("Success handler failed: "+t.message,"SUCCESS_HANDLER_ERROR",t)}},handleAjaxError:function(t,e,n,r){try{var i=this.strings.error||"An error occurred. Please try again.";0===t.status?i=this.strings.network_error||"Network error. Please check your connection.":403===t.status?i=this.strings.permission_denied||"Permission denied. Please refresh the page and try again.":429===t.status?i=this.strings.rate_limit||"Too many requests. Please wait a moment and try again.":t.status>=500?i="Server error. Please try again later.":"timeout"===e?i="Request timed out. Please try again.":t.responseJSON&&t.responseJSON.data&&t.responseJSON.data.message&&(i=t.responseJSON.data.message),this.showNotification(i,"error"),this.logError("AJAX Error",{status:t.status,statusText:e,error:n,url:r?r.url:"unknown",response:t.responseText}),this.sendErrorToServer({type:"ajax_error",status:t.status,statusText:e,error:n,url:r?r.url:"unknown",timestamp:(new Date).toISOString()})}catch(t){this.handleError("Error handler failed: "+t.message,"ERROR_HANDLER_ERROR",t)}},handleExportSuccess:function(t){try{if(t&&t.data){var e=JSON.stringify(t.data,null,2),n=new Blob([e],{type:"application/json"}),r=window.URL.createObjectURL(n),i=document.createElement("a");i.href=r,i.download="ennu-user-data-".concat(t.data._metadata.user_id,"-").concat((new Date).toISOString().split("T")[0],".json"),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(r)}}catch(t){this.handleError("Export file creation failed: "+t.message,"EXPORT_FILE_ERROR",t)}},checkRateLimit:function(){var t=Date.now();return t-this.state.lastRequestTime>6e4&&(this.state.requestCount=0),!(this.state.requestCount>=this.config.maxRequestsPerMinute||(this.state.requestCount++,this.state.lastRequestTime=t,0))},setButtonLoading:function(t,e,n){e?(t.disabled=!0,t.classList.add("ennu-loading"),t.dataset.originalText=t.textContent,t.innerHTML='<span class="dashicons dashicons-update-alt"></span> '+(n||"Loading...")):(t.disabled=!1,t.classList.remove("ennu-loading"),t.innerHTML=t.dataset.originalText||t.textContent)},showNotification:function(t,e,n){try{if(!document.getElementById("ennu-operation-status"))return;n=n||("error"===e?8e3:4e3),$status.removeClass("show loading success error warning").addClass("show "+e).html(this.getNotificationIcon(e)+" "+t),"loading"!==e&&setTimeout(function(){$status.removeClass("show")},n)}catch(t){}},getNotificationIcon:function(t){return{loading:'<span class="dashicons dashicons-update-alt"></span>',success:'<span class="dashicons dashicons-yes-alt"></span>',error:'<span class="dashicons dashicons-warning"></span>',warning:'<span class="dashicons dashicons-info"></span>'}[t]||""},animateProgressBars:function(){try{document.querySelectorAll(".ennu-progress-bar").forEach(function(t){var e=getComputedStyle(t).width;t.style.width="0",t.style.transition="width 1000ms",setTimeout(function(){return t.style.width=e},10)})}catch(t){this.log("Progress bar animation failed: "+t.message,"warning")}},updateCacheStatus:function(){try{var t=document.querySelector(".ennu-cache-indicator");t&&t.classList.contains("active")&&t.classList.add("pulse")}catch(t){this.log("Cache status update failed: "+t.message,"warning")}},refreshPageData:function(){try{this.updateCacheStatus()}catch(t){this.log("Page data refresh failed: "+t.message,"warning")}},getUserId:function(){var t=new URLSearchParams(window.location.search).get("user_id");if(!t){var e=window.location.pathname.match(/user-edit\.php.*user_id=(\d+)/);e&&(t=e[1])}if(!t){var n=document.getElementById("user_id");n&&(t=n.value)}return t?parseInt(t,10):null},handleError:function(t,e,n){this.logError(e||"GENERAL_ERROR",t,n),this.showNotification("A system error occurred. Please refresh the page and try again.","error")},logError:function(t,e,n){var r={timestamp:(new Date).toISOString(),type:t,message:e,error:n?n.toString():null,stack:n?n.stack:null,userAgent:navigator.userAgent,url:window.location.href};this.errors.log.push(r),this.errors.log.length>this.errors.maxLogSize&&(this.errors.log=this.errors.log.slice(-this.errors.maxLogSize)),this.config.debugMode},sendErrorToServer:function(t){try{if(this.errors.log.length>10)return;fetch(this.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"ennu_log_client_error",nonce:this.nonce,error_data:JSON.stringify(t)})}).catch(function(){})}catch(t){}},handleUnhandledRejection:function(t){this.logError("UNHANDLED_PROMISE_REJECTION",t.reason)},handleGlobalError:function(t){this.logError("GLOBAL_ERROR",t.message,{filename:t.filename,lineno:t.lineno,colno:t.colno})},log:function(t,e){e=e||"info",this.config.debugMode},getErrorLog:function(){return this.errors.log},clearErrorLog:function(){this.errors.log=[]}};document.addEventListener("DOMContentLoaded",function(){t.init()}),window.ENNUAdminEnhanced=t}();
//# sourceMappingURL=admin-scores-enhanced.min.js.map