document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("ennu-clear-data");e&&e.addEventListener("click",function(){if(confirm(ennu_admin.confirm_msg)){const e=this.dataset.userId,a=ennu_admin.nonce,n=new FormData;n.append("action","ennu_clear_user_data"),n.append("user_id",e),n.append("nonce",a),fetch(ennu_admin.ajax_url,{method:"POST",body:n}).then(e=>e.json()).then(e=>{e.success?(alert(e.data),location.reload()):alert("Error: "+e.data)}).catch(e=>{console.error("Error:",e),alert("AJAX error - please try again.")})}});const a=document.querySelector(".ennu-admin-tabs");if(a){const e=a.querySelectorAll(".ennu-admin-tab-nav a"),n=a.querySelectorAll(".ennu-admin-tab-content");e.forEach(a=>{a.addEventListener("click",function(a){a.preventDefault();const t=this.getAttribute("href");e.forEach(e=>e.classList.remove("ennu-admin-tab-active")),n.forEach(e=>e.classList.remove("ennu-admin-tab-active")),this.classList.add("ennu-admin-tab-active"),document.querySelector(t).classList.add("ennu-admin-tab-active")})})}const n=document.querySelector(".ennu-admin-action-buttons .spinner"),t=document.getElementById("ennu-recalculate-scores");t&&t.addEventListener("click",function(){if(confirm("Are you sure you want to recalculate all scores for this user? This will overwrite their current calculated scores.")){this.disabled=!0,n.classList.add("is-active");const e=this.dataset.userId,a=ennuAdmin.nonce,t=new URLSearchParams;t.append("action","ennu_recalculate_all_scores"),t.append("user_id",e),t.append("nonce",a),fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t}).then(e=>e.json()).then(e=>{e.success?(alert("Scores recalculated successfully!"),location.reload()):alert("An error occurred: "+e.data.message)}).catch(e=>{console.error("Error:",e),alert("A server error occurred.")}).finally(()=>{this.disabled=!1,n.classList.remove("is-active")})}});const s=document.getElementById("ennu-clear-all-data");s&&s.addEventListener("click",function(){if(confirm("WARNING: Are you absolutely sure you want to clear ALL assessment data for this user? This action cannot be undone.")){this.disabled=!0,n.classList.add("is-active");const e=this.dataset.userId,a=ennuAdmin.nonce,t=new URLSearchParams;t.append("action","ennu_clear_all_assessment_data"),t.append("user_id",e),t.append("nonce",a),fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t}).then(e=>e.json()).then(e=>{e.success?(alert("All assessment data cleared successfully!"),location.reload()):alert("An error occurred: "+e.data.message)}).catch(e=>{console.error("Error:",e),alert("A server error occurred.")}).finally(()=>{this.disabled=!1,n.classList.remove("is-active")})}}),document.querySelectorAll(".ennu-clear-single-assessment-data").forEach(e=>{e.addEventListener("click",function(){const e=this.dataset.assessmentKey;if(confirm("Are you sure you want to clear the data for the "+e.replace(/_/g," ")+" assessment? This action cannot be undone.")){this.disabled=!0,n.classList.add("is-active");const a=this.dataset.userId,t=ennuAdmin.nonce,s=new URLSearchParams;s.append("action","ennu_clear_single_assessment_data"),s.append("user_id",a),s.append("assessment_key",e),s.append("nonce",t),fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:s}).then(e=>e.json()).then(a=>{a.success?(alert(e.replace(/_/g," ")+" data cleared successfully!"),location.reload()):alert("An error occurred: "+a.data.message)}).catch(e=>{console.error("Error:",e),alert("A server error occurred.")}).finally(()=>{this.disabled=!1,n.classList.remove("is-active")})}})})});